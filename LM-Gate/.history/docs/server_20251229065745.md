Summary (File Lifecycle): server.go
1. OnMessage(msg ChunkMessage)

This function is the core of the file and the main entry point for all incoming messages.

Validation:
It first checks if the message is valid by calling ValidateMessage.

If the message is a normal chunk:
The chunk is stored on disk using StoreChunk.

If the message is the end signal (IsEOF):

All chunks are combined into a single file using AssembleFile.

The completed file is sent for analysis using ProcessFile.

Temporary chunks are deleted to save disk space using Cleanup.

2. ValidateMessage(msg ChunkMessage)

A simple security function to validate incoming data:

Checks that FileID exists.

Ensures the message is not empty unless it is an end-of-file signal (IsEOF).

3. StoreChunk(msg ChunkMessage)

Responsible for temporary storage:

Creates a dedicated folder for each file inside temp_chunks using the file ID.

Saves each chunk as a separate file named part_X (where X is the chunk number).

Uses the filesystem (disk) instead of memory to avoid high RAM usage with large files.

4. IsFileComplete(fileID string)

A checking function:

Verifies whether there are already stored chunks for the requested file inside the temporary directory.

5. AssembleFile(fileID string)

Responsible for rebuilding the file:

Creates the final .pcap file inside the uploads directory.

Searches for chunks in order (part_0, part_1, …) and merges their contents into the final file.

Stops immediately when the next chunk in the sequence is not found.

Output:
Returns the full path of the assembled file.

6. ProcessFile(fileID string, filePath string)

The bridge to the analysis layer:

Takes the path of the completed file and sends it to an external package called analysis.

Calls the AnalyzePCAP function to technically analyze the PCAP file.

7. Cleanup(fileID string)

Housekeeping function:

After assembly and analysis are finished, it deletes the temporary directory that contains the chunks (temp_chunks/fileID) to keep the server clean.

File Processing Flow

Chunk arrival:
StoreChunk saves chunks one by one.

End signal arrival:
AssembleFile combines all chunks into a single .pcap file.

Analysis:
ProcessFile analyzes the completed file.

Cleanup:
Cleanup removes temporary chunks that are no longer needed.




ChunkMessage
   ↓
OnMessage
   ↓
ValidateMessage
   ↓
StoreChunk ──→ AssembleFile ──→ ProcessFile ──→ Cleanup
