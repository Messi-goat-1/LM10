package events

// FileDetectedPayload ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„ØªÙ‚Ù†ÙŠØ©
type FileDetectedPayload struct {
	FileID      string `json:"file_id"`
	FileName    string `json:"file_name"`
	SizeBytes   int64  `json:"size_bytes"`
	FileType    string `json:"file_type"`
	Checksum    string `json:"checksum"`
	StorageHint string `json:"storage_hint"`
}

// FileDetectedEvent Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
type FileDetectedEvent struct {
	Payload FileDetectedPayload `json:"payload"`

	Timestamp string `json:"timestamp"`
}


package handlers

import (
	"LM-Gate/events"
	"LM-Gate/services"
)

// FileDetectedHandler ÙŠØ±Ø¨Ø· event Ù…Ø¹ service
type FileDetectedHandler struct {
	fileService *services.Manager
}

// constructor
func NewFileDetectedHandler(fs *services.Manager) *FileDetectedHandler {
	return &FileDetectedHandler{
		fileService: fs,
	}
}

// Handle ØªÙØ³ØªØ¯Ø¹Ù‰ Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ Ø§Ù„Ø­Ø¯Ø«

// file_detected.go

func (h *FileDetectedHandler) Handle(event events.FileDetectedEvent) {
	// ØªÙ…Ø±ÙŠØ± ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ù€ Payload Ø¥Ù„Ù‰ Ø§Ù„Ù€ Service
	h.fileService.OnFileDetected(
		event.Payload.FileID,
		event.Payload.FileName,
		event.Payload.SizeBytes,
		event.Payload.FileType,
		event.Payload.Checksum,
	)
}

package services

import (
	"fmt"
	"time"
)

// FileService Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„ÙØ§Øª
type FileService struct{}

func NewFileService() *FileService {
	return &FileService{}
}

// OnFileDetected ØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡Ø§ Ù„ØªØ³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ù† Ø§Ù„Ù€ Payload
func (s *FileService) OnFileDetected(fileID string, fileName string, size int64, fileType string, checksum string) {
	fmt.Println("ğŸš€ [SERVICE] Ø¨Ø¯Ø£ Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯")
	fmt.Printf("   ID: %s\n", fileID)
	fmt.Printf("   Ø§Ù„Ø§Ø³Ù…: %s\n", fileName)
	fmt.Printf("   Ø§Ù„Ø­Ø¬Ù…: %d bytes\n", size)
	fmt.Printf("   Ø§Ù„Ù†ÙˆØ¹: %s\n", fileType)
	fmt.Printf("   Ø§Ù„ØªØ­Ù‚Ù‚ (Checksum): %s\n", checksum)
	fmt.Printf("   ÙˆÙ‚Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: %s\n", time.Now().Format(time.RFC3339))

	// Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ø­Ù‚ÙŠÙ‚ÙŠ Ù…Ø«Ù„:
	// 1. Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù Ù…ÙƒØ±Ø± Ø¹Ø¨Ø± Ø§Ù„Ù€ Checksum
	// 2. ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
	// 3. Ù†Ù‚Ù„ Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ Ù…ÙƒØ§Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
}
